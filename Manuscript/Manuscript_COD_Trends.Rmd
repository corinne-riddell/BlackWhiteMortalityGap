---
title: "null"
bibliography: bibliography.bib
output:
  word_document: default
  html_document: default
always_allow_html: yes
---

Corinne A Riddell, PhD

Kathryn T Morrison, PhD

Sam Harper, PhD

Jay S Kaufman, PhD

Department of Epidemiology, Biostatistics and Occupational Health, McGill University, Montreal, Canada.

Address correspondence to: Corinne Riddell, PhD, Department of Epidemiology, Biostatistics & Occupational Health, McGill University, 1020 Pine Avenue West, Room 36B, Montreal, QC H3A 1A2, Canada. Email: <corinne.riddell@mail.mcgill.ca>

###Abstract

**Background**

**Methods and Findings**

**Conclusions:**

###Introduction

The life expectancy of a population is a barometer for overall health. In 2014, life expectancy in the United States was 78.8 years, but hidden within this figure are differences by race. Whites lived 3.4 years longer than Blacks [ref: http://www.cdc.gov/nchs/data/nvsr/nvsr65/nvsr65_04.pdf]. While both black and white Americans have generally experienced increases in life expectancy since the beginning of the 20^th^ century, the difference between their life expectancies has varied. 

During the 1980s, the life expectancy gap widened and then narrowed in the 1990s due largely to relative mortality improvements among blacks in deaths due to homicide, HIV, unintentional injuries, and, among females, due to differential improvements in heart disease [@harper2007trends]. The gap continued to narrow during the 2000s, but states differed markedly in the magnitude of improvement. For example, the life expectancy gap in New York decreased from 8.0 years to 2.4 years between 1990 and 2009, but in California the decrease was much more modest -- from 6.7 years to 5.6 years [@harper2014trends]. 

The over-arching objective of this study was to describe the general pattern of each cause of death's contribution to the black-white life expectancy gap over forty-five years, and identify divergent states and differences between the sexes. To do so, we estimated state-level trends in the contribution of six major causes of death to the black-white life expectancy gap for males and females. Common reasons for the decreasing life expectancy gap can thereby be identified, and anomalous states can be examined. Ideally, this study may facilitate the identification of one policies or social conditions in highly successful states, and suggest broad targets for interventions to further reduce the gap in less successful states. 

###Methods

**Description of the mortality data**

We used software maintained by the National Cancer Institute's Surveillance, Epidemiology, and End Results Program (SEERStat) to extract data on the number of deaths and the population size in all 50 US states and the District of Columbia between 1969 and 2013. The mortality data were originally collected by the National Center for Health Statistics (NCHS) from death certificates and stored by the National Vital Statistics System. The population data were derived by the NCHS using intercensal bridged-race population estimates. This study used data on the number of deaths and the population size according to race (black or white), sex (male or female), age group (<1 year old, 1-4 years old, followed by 5-year age groupings, with a final grouping of 85 or more years of age), year (1969 -- 2013), and cause of death. Cause of death was originally recorded using the International Classification of Diseases (ICD) codes versions 8 (1969-1979), 9 (1979-1998), and 10 (1999-2013). These codes were aggregated into six broad causes of death for this analysis: Cancers, Cardiovascular disease, Communicable disease, Injuries, Non-communicable disease, and All other causes (**S1 Table**). When the number of deaths for a population stratum is between 1 and 9, this data point is suppressed by the software and produces a missing death count for that cell However, death counts of exactly 0 or greater than 9 are known precisely. 

For the analysis we excluded 11 states with the smallest black populations: Alaska, Hawaii, Idaho, Maine, Montana, New Hampshire, North Dakota, South Dakota, Utah, Vermont, and Wyoming. These states contained less than 0.4% of the black population in the United States in 2010 [ref]. We did not consider Hispanic origin to identify race according to Hispanic ethnicity, since the quality of the coding of ethnicity varied by state over the time period included [https://www.cdc.gov/nchs/data/series/sr_02/sr02_148.pdf].   
  
**Statistical challenges to be addressed**

The data structure produced two statistical challenges that were addressed by our quantitative approach. First, our methodology needed to impute the suppressed death counts (for counts between 1 and 9). Second, several states had small black populations which produced sparse counts in each sex-age category. In these cases, the estimation of the sex-age mortality rates is imprecise, and can produce abrupt changes in the estimated mortality rates over time that are unrealistic. To better estimate the underlying age-specific mortality rates, a method that produces smoother age-specific mortality trends was required.

**Estimation of smoothed mortality rates using a Bayesian autoregressive model**

To address these challenges, we used a Bayesian autoregressive model to smooth the data over time, and incorporated a truncated Poisson model to impute the suppressed death counts. Specifically, we used Poisson regression to model the number of deaths in each state-age-sex-race-year category as a function of the at-risk population. The mortality rates over time within each state-age-sex-race category are modeled autoregressively, where the log mortality rate in the current year was modeled as a normal variable centered at the log mortality rate estimated from the previous year. Truncated Poisson regression was used to impute the suppressed death counts, by specifying that the suppressed counts were sampled from a Poisson distribution and were constrained to be between 1 and the maximum of 9 and the at-risk population size (which may be smaller than 9). 

These models were run separately for every combination of state, race, and sex. They were fit using two markov chains of length 10,000. One thousand iterations remained after discarding the first two thousand iterations as burn-in and sampling every eighth iteration (to reduce autocorrelation). Each iteration produced death count estimates that were smoothed over time for every cause of death within each age group, which were used to estimate life expectancy, the life expectancy gap, and perform a cause of death decomposition. These 1,000 decompositions form the posterior distribution from which the credible intervals were estimated using the 2.5^th^ and 97.5^th^ percentiles. 

**Decomposition of the life expectancy gap by cause of death**

To calculate life expectancy at birth, the smoothed death counts were aggregated to estimate the total deaths in each age group and standard life table methods were applied [ref]. Life expectancy at birth (in years) was calculated for blacks and whites in each state and year according to sex. The difference in life expectancy between blacks and whites was calculated by subtracting the black life expectancy from the white life expectancy in each state, year, and sex.

To examine the components of the difference in life expectancy between blacks and whites, we performed a decomposition analysis using the Arriaga method [ref]. First, the model partitions the difference in life expectancy by age group, which can be interpreted as the amount of the gap (in years) that can be attributed to higher age-specific mortality rates in blacks. For example, a decomposition of a gap of five years may find that two of the five years (40% of the gap) is attributable to a higher mortality rate in blacks in the youngest age group (< 1 years old) compared with the youngest whites. This age-specific decomposition can be further partitioned according to cause of death, producing the number of years of the gap that is attributable to every age- and cause-of-death combination. For example, a decomposition of a gap of 8 years may find that 1.3 years of this gap is attributable to more injury-related deaths in blacks aged 25-29 years old. We summed these age- and cause-of-death partitions over all ages to calculate the marginal contribution of each cause-of-death to the difference, for each state and for each sex. Thus, for each state, the contribution of each of the six causes to the black-white life expectancy gap was estimated for each year, producing 45 state-level trends and their credible intervals.

**Description of the trend in each cause of death's contribution to the gap and identification of divergent states**

To describe the general pattern in these trend lines, we regressed each state's mean contribution against a linear spline for calendar time that was estimated with five degrees of freedom. This model also contained fixed effects for state and was inversely-weighted by the standard error of each state's mean estimate within each year. We then calculated residuals for each year by substracting the meta-estimated contribution from the smoothed-observed estimated contribution and summed these residuals over time for each state to rank states according to how well the model predicted their pattern. Plots of these residuals over time were used to identify divergent states.

*Need to add information on the trends in mortality* -- where?

###Results
```{r initialize, echo=FALSE, warning=F, message=F}
library(plotly)
library(viridis)
library(scales)
library(dplyr)
library(purrr)
library(stringr)
library(DT)
library(splines)
library(broom)
library(tidyverse)

source("/Users/corinneriddell/Documents/repos/BlackWhiteMortalityGap/Code/life_expectancy_functions.R")
```

```{r load_data, echo=F}
BlackWhite_results <- read.csv("/Users/corinneriddell/Documents/repos/BlackWhiteMortalityGap/Results/BlackWhite_results.csv")
BlackWhite_results <- reorder.as.map(BlackWhite_results, "state")

cod_decomp_results <- read.csv("/Users/corinneriddell/Documents/repos/BlackWhiteMortalityGap/Results/cod_decomp_results.csv")
cod_decomp_results$COD_cont_yrs_width <- cod_decomp_results$COD_cont_yrs_ucl - cod_decomp_results$COD_cont_yrs_lcl
cod_decomp_results$COD_cont_yrs_SE <- (cod_decomp_results$COD_cont_yrs_ucl - cod_decomp_results$COD_cont_yrs_lcl)/3.92
```

```{r life-expectancy-trends, echo=F}
LE_trend_plot_males <- ggplot(data = subset(BlackWhite_results, sex == "Male"), aes(y = LE_wbgap_mean, x = year)) + #, sex == "Male"
  geom_hline(aes(yintercept = 0)) + geom_vline(aes(xintercept = 1969)) +             
  geom_ribbon(aes(ymin = LE_wbgap_lcl, ymax = LE_wbgap_ucl, fill = Census_Division)) +
  #geom_line(aes(col = Census_Division)) + #add this for the online version, and then adjust legend and hover display
  facet_wrap(~ state.map.order, ncol = 11, drop = F) +
  theme_classic(base_size = 10) +
  theme(axis.text.x = element_blank(),
        strip.background=element_blank(),
        axis.line=element_blank(),
        axis.ticks=element_blank()) +
  ylab("Life expectancy gap (years)") +
  xlab("Year (1969-2013)")

LE_trend_plot_females <- ggplot(data = subset(BlackWhite_results, sex == "Female"), aes(y = LE_wbgap_mean, x = year)) + 
  geom_hline(aes(yintercept = 0)) + geom_vline(aes(xintercept = 1969)) +             
  geom_ribbon(aes(ymin = LE_wbgap_lcl, ymax = LE_wbgap_ucl, fill = Census_Division)) +
  #geom_line(aes(col = Census_Division)) + #add this for the online version, and then adjust legend and hover display
  facet_wrap(~ state.map.order, ncol = 11, drop = F) +
  theme_classic(base_size = 10) +
  theme(axis.text.x = element_blank(),
        strip.background=element_blank(),
        axis.line=element_blank(),
        axis.ticks=element_blank()) +
  ylab("Life expectancy gap (years)") +
  xlab("Year (1969-2013)")
```  

```{r plot_both, eval=F, echo=F}
#Informative: male and females at the same time
ggplotly(ggplot(data = subset(BlackWhite_results), aes(y = LE_wbgap_mean, x = year)) + #, sex == "Male"
  geom_hline(aes(yintercept = 0)) + geom_vline(aes(xintercept = 1969)) +
  geom_ribbon(aes(ymin = LE_wbgap_lcl, ymax = LE_wbgap_ucl, group = sex, fill = Census_Division), alpha = 0.5) +
  geom_line(aes(group = sex, col = Census_Division)) + #add this for the online version, and then adjust legend and hover display
  facet_wrap(~ state.map.order, ncol = 11, drop = F) +
  theme_classic(base_size = 10) +
  theme(axis.text.x = element_blank(),
        strip.background=element_blank(),
        axis.line=element_blank(),
        axis.ticks=element_blank()) +
  ylab("Life expectancy gap (years)") +
  xlab("Year (1969-2013)"))
```


```{r meta_regression_of_cod_contribution, echo = F}
#run 12 stratified models. bs() created the b-spline basis
models <- cod_decomp_results %>% 
  group_by(COD, sex) %>%
  do(fit = lm(COD_cont_yrs_mean ~ bs(year, degree = 1, df = 5) + state, 
              weights = 1/(COD_cont_yrs_SE)^2, 
              data = .)) 

#calculated predicted values for all models
dfPred = broom::augment(models, fit)
dfPred$year <- 1969:2013

#merge the predictions with original dataset
cod_decomp_results <- merge(cod_decomp_results, 
                            dfPred %>% select(COD, sex, year, state, .fitted, .resid), 
                            by = c("COD", "sex", "state", "year"))

#calculated the sum of the residuals for each state-sex-cod strata (summed over years)
cod_decomp_results <- cod_decomp_results %>% 
  group_by(state, sex, COD) %>%
  mutate(sum.residual = sum(abs(.resid)))
```

```{r plotting_resid_fx, echo = F}
plot.resid.trends <- function(dataset, COD1, sex1) {
  subset.data <- subset(dataset, COD == COD1 & sex == sex1)
  subset.data$order <- reorder(subset.data$state, subset.data$sum.residual, first)
  
  a <- ggplot(subset.data,
         aes(x = year, y = COD_cont_yrs_mean)) + 
    #geom_line(aes(col = "Observed")) + 
    geom_ribbon(aes(ymin = COD_cont_yrs_lcl, ymax = COD_cont_yrs_ucl), fill = "#abd9e9") +
    geom_hline(yintercept = 0, col = "black") +
    #scale_fill_manual(values = c("#b2e2e2")) +
    facet_wrap( ~ order) + 
    geom_line(aes(y = .fitted), col = "#d7191c") +
    #scale_color_manual(values = c("#006d2c")) +
    xlab(" ") + ylab("estimated smoothed contribution vs. common trend (years)") + 
    ggtitle(paste0("Estimated smoothed contribution vs. meta-estimated common trend in ", COD1, " in ", sex1)) +
    theme_minimal() + theme(axis.text.x = element_text(angle = 45, hjust = 1))

  
  b <- ggplot(subset.data,
              aes(x = year, y = .resid)) + geom_line(aes(col = "Residual")) + 
    scale_color_manual(values = c("#d7191c")) +    
    facet_wrap( ~ order) +
    xlab(" ") + ylab("Residual") +
    geom_hline(yintercept = 0, col = "black") +
      geom_text(data = subset(subset.data, year == 2010), 
                aes(y = 1, label = round(sum.residual, 1)), size = 2.5) + 
    ggtitle(paste0("Residuals vs. year in ", COD1, " in ", sex1)) +
    theme_minimal() + theme(axis.text.x = element_text(angle = 45, hjust = 1))
  
    return(list(plot1 = a, plot2 = b))
}
```

```{r create-the-resid-plots, echo = F, message = F}
for(COD_i in levels(cod_decomp_results$COD)) {
  for(sex_i in levels(cod_decomp_results$sex)) {
    assign(paste0(COD_i, ".", sex_i, ".plot"), plot.resid.trends(dataset = cod_decomp_results, 
                                                                         COD1 = COD_i, sex1 = sex_i))
  }
}
```

**Figures 1 and 2** display trends in the life expectancy gap for males and females, respectively. For both sexes, the life expectancy gap has decreased since 1969, although several states exhibited a period of increasing inequality that peaked in the early 1990s, especially among males. 

**Figures 2 - 14** display trends in the contribution of each cause of death to the life expectancy gap for males and females, in years. The blue band illustrates the credible interval for the smoothed contribution estimated for each state, and illustrates the heterogeneity across states in their contributions trends. These curves are overlaid with the meta-estimated common trend, shown with a red line, and the plots are organized according to the closeness of the [fit] (*need another word*) of the red curve to the blue band. Thus, increasingly divergent states are shown further down the display. We supplement these main results with smoothed estimates of the age-standardized mortality rates for each cause of death (**eFigures 1-12**). 

**Cardiovascular disease**

Cardiovascular disease (CVD) is the most common cause of death for both men and women of both races. Mortality from CVD decreased markedly since 1969 for both sexes and races (**eFigures 1 and 2**). However, white males underwent relatively larger mortality decreases than black males, resulting in a modest increase to the contribution of CVD to the life expectancy gap for most states (**Figure 3**). In particular, Pennsylvania, Michigan, Wisconsin, and Washington DC experienced relatively larger increases to their CVD contributions to the gap for males, while some states such as Illinois and Kentucky exhibited relatively larger early contributions in the 1970s. 

The situation was reversed for females, with black females experiencing relatively larger mortality decreases over time compared to white females. Thus, the contribution of CVD to the life expectancy gap decreased by more than a year in several states (**Figure 4**). Of note, some states experienced a period of early increasing contributions, most notably, Arizona, Washington, and Oregon, that was not captured by the general pattern. Furthermore, Wisconsin and Washington DC both exhibit increasing contributions over time, as mortality gains among white females outpaced those among black females. 

**Cancer**

For all races and sexes, mortality from cancer peaked in the mid 1990s and decreased thereafter (**eFigures 3 and 4**). Among males, this inverted U-shape pattern was accentuated among blacks, which resulted in an inverted-U shape pattern in the difference in mortality between black and white males and in cancer's contribution to the life expectancy gap (**Figure 5**). Notable exceptions to this general pattern include Washington DC and Mississippi, states that underwent increasing cancer contributions over time, and New Mexico and Rhode Island, exhibiting decreasing contributions over time (although imprecisely estimated).

For females, while cancer-related mortality continues to be higher among blacks in many states, the inverted-U pattern is similar between blacks and whites and most states do not exhibit the accentuated period of increase in mortality that was estimated for black males. Thus, the contribution of cancer to the life expectancy gap is generally flat over time (**Figure 6**). Washington DC deviates from this pattern, and exhibited increasing cancer contributions to the gap, while Rhode Island exhibited the reverse. Most notably, some states exhibited no inequality in cancer mortality (**eFigures 3 and 4**), including New York, and Connecticut (and for males, these states recently eliminated the black-white difference in cancer mortality). Furthermore, Massachusetts and (imprecisely) Rhode Island exhibit lower cancer rates among black women and men compared to whites in 2013.

****

**Figure 1: State-level trends in the difference in life expectancy between blacks and whites in males, United States, 1969-2013**

```{r plot_LE_trends_males, echo=F, fig.height=9, fig.width=11}
ggplotly(LE_trend_plot_males)
```

**Figure 2: State-level trends in the difference in life expectancy between blacks and whites in females, United States, 1969-2013**

```{r plot_LE_trends_females, echo=F, fig.height=9, fig.width=11}
ggplotly(LE_trend_plot_females)
```

**Figure 3: Smoothed state-level trends in the contribution of cardiovascular disease to the life expectancy gap vs. the overall pattern in males**

```{r print-plot, fig.width = 9, fig.height = 9, echo = F}
ggplotly(Cardiovascular.Male.plot[[1]]) %>% layout(xaxis = list(title = "Year"))
ggplotly(Cardiovascular.Male.plot[[2]]) %>% layout(xaxis = list(title = "Year"))
```

**Figure 4: Smoothed state-level trends in the contribution of cardiovascular disease to the life expectancy gap vs. the overall pattern in females**

```{r print-plot-2, fig.width = 9, fig.height = 9, echo = F}
ggplotly(Cardiovascular.Female.plot[[1]]) %>% layout(xaxis = list(title = "Year"))
ggplotly(Cardiovascular.Female.plot[[2]]) %>% layout(xaxis = list(title = "Year"))
```

**Figure 5: Smoothed state-level trends in the contribution of cancer disease to the life expectancy gap vs. the overall pattern in males**

```{r print-plot-3, fig.width = 9, fig.height = 9, echo = F}
ggplotly(Cancers.Male.plot[[1]]) %>% layout(xaxis = list(title = "Year"))
ggplotly(Cancers.Male.plot[[2]]) %>% layout(xaxis = list(title = "Year"))
```

**Figure 6: Smoothed state-level trends in the contribution of cancer disease to the life expectancy gap vs. the overall pattern in females**

```{r print-plot-4, fig.width = 9, fig.height = 9, echo = F}
ggplotly(Cancers.Female.plot[[1]]) %>% layout(xaxis = list(title = "Year"))
ggplotly(Cancers.Female.plot[[2]]) %>% layout(xaxis = list(title = "Year"))
```

```{r print-plot-5, fig.width = 9, fig.height=9, echo = F, eval = F}
ggplotly(Communicable.Male.plot[[1]]) %>% layout(xaxis = list(title = "Year"))
ggplotly(Communicable.Male.plot[[2]]) %>% layout(xaxis = list(title = "Year"))

ggplotly(Communicable.Female.plot[[1]]) %>% layout(xaxis = list(title = "Year"))
ggplotly(Communicable.Female.plot[[2]]) %>% layout(xaxis = list(title = "Year"))

ggplotly(`Non-communicable.Male.plot`[[1]]) %>% layout(xaxis = list(title = "Year"))
ggplotly(`Non-communicable.Male.plot`[[2]]) %>% layout(xaxis = list(title = "Year"))

ggplotly(`Non-communicable.Female.plot`[[1]]) %>% layout(xaxis = list(title = "Year"))
ggplotly(`Non-communicable.Male.plot`[[2]]) %>% layout(xaxis = list(title = "Year"))

ggplotly(Injuries.Male.plot[[1]]) %>% layout(xaxis = list(title = "Year"))
ggplotly(Injuries.Male.plot[[2]]) %>% layout(xaxis = list(title = "Year"))

ggplotly(Injuries.Female.plot[[1]]) %>% layout(xaxis = list(title = "Year"))
ggplotly(Injuries.Female.plot[[2]]) %>% layout(xaxis = list(title = "Year"))

ggplotly(`All other causes.Male.plot`[[1]]) %>% layout(xaxis = list(title = "Year"))
ggplotly(`All other causes.Male.plot`[[2]]) %>% layout(xaxis = list(title = "Year"))

ggplotly(`All other causes.Female.plot`[[1]]) %>% layout(xaxis = list(title = "Year"))
ggplotly(`All other causes.Female.plot`[[2]]) %>% layout(xaxis = list(title = "Year"))
```

###Discussion 

###Appendix

###Bibliography
