---
title: "Untitled"
author: "Corinne Riddell"
date: "2/8/2017"
output: html_document
---

```{r load_libraries, echo=FALSE, warning=F, message=F}
library(dplyr)
library(purrr)
library(ggplot2)
library(stringr)
library(reshape2)
library(grid)
library(gridExtra)
library(plotly)
```

```{r, echo=F}
mortality.rates <- read.csv("/Users/corinneriddell/Documents/repos/BlackWhiteMortalityGap/Data/mortality_rates.csv")
mortality.rates.wide <- read.csv("/Users/corinneriddell/Documents/repos/BlackWhiteMortalityGap/Data/mortality_rates_wide.csv")

mortality.rates <- mortality.rates %>% mutate(state.reorder = reorder(state, as.numeric(Census_Division)))
mortality.rates.wide <- mortality.rates.wide %>% mutate(state.reorder = reorder(state, as.numeric(Census_Division)))
```


```{r, echo=F, fig.width=11, fig.height=11}
for(sex_i in c("Male", "Female")) {
  for(cod in levels(mortality.rates$COD)) {
    data.sub <- subset(mortality.rates, sex == sex_i & post.samp == 1 & COD == cod)
    a <- ggplot(data.sub, 
                aes(y=rate.per.100k, x = year)) + 
      geom_vline(aes(xintercept = 1983), col = "#636363", lty = 3) +
      geom_vline(aes(xintercept = 1993), col = "#636363", lty = 3) +
      geom_line(aes(col = Census_Division, lty = race)) +
      facet_wrap( ~ state.reorder, ncol = 5) +
      ylab("Age-standardized mortality rate (per 100,000)") +
      xlab("Year") + 
      ggtitle(paste0("Age-adjusted mortality (per 100,000) in ", sex_i, " for ", cod))
    
    print(a)
    
    b <- ggplot(subset(mortality.rates.wide, sex == sex_i & post.samp == 1 & COD == cod), 
                aes(y=rate.difference, x = year)) + 
      geom_vline(aes(xintercept = 1983), col = "#636363", lty = 3) +
      geom_vline(aes(xintercept = 1993), col = "#636363", lty = 3) +
      geom_hline(aes(yintercept = 0), col = "#636363") +
      geom_line(aes(col = Census_Division)) +
      facet_wrap( ~ state.reorder, ncol = 5) +
      ylab("Black-white difference (per 100,000)") +
      xlab("Year") + 
      ggtitle(paste0("Black-white difference in age-adjusted mortality (per 100,000) in ", 
                     sex_i, " for ", cod))
    print(b)
    
  }
}
```

```{r, echo=F, fig.width=11, eval = F}
for(sex_i in c("Male", "Female")) {
  for(cod in levels(mortality.rates$COD)) {
    for(region in levels(mortality.rates$Census_Region)) {
      data.sub <- subset(mortality.rates, sex == sex_i & post.samp == 1 & COD == cod  & Census_Region == region)
      a <- ggplot(data.sub, 
                      aes(y=rate.per.100k, x = year)) + 
                 geom_vline(aes(xintercept = 1983), col = "#636363", lty = 3) +
                 geom_vline(aes(xintercept = 1993), col = "#636363", lty = 3) +
                 geom_line(aes(col = state, lty = race)) +
                 facet_wrap( ~ state, ncol = 5) +
                 ylab("Age-standardized mortality rate (per 100,000)") +
                 xlab("Year") + 
                 ggtitle(paste0("Age-adjusted mortality (per 100,000) in ", sex_i, " for ", cod, " (Census Region: ", region, ")"))
      print(a)
    }
    for(region in levels(mortality.rates$Census_Region)) {    
          b <- ggplot(subset(mortality.rates.wide, sex == sex_i & post.samp == 1 & COD == cod & Census_Region == region), 
                      aes(y=rate.difference, x = year)) + 
                 geom_vline(aes(xintercept = 1983), col = "#636363", lty = 3) +
                 geom_vline(aes(xintercept = 1993), col = "#636363", lty = 3) +
                 geom_hline(aes(yintercept = 0), col = "#636363") +
                 geom_line(aes(col = state)) +
                 facet_wrap( ~ state, ncol = 5) +
                 ylab("Black-white difference (per 100,000)") +
                 xlab("Year") + 
                 ggtitle(paste0("Black-white difference in age-adjusted mortality (per 100,000) in ", 
                                sex_i, " for ", cod, " (Census Region: ", region, ")"))
          print(b)
    }
  }
}
```
